buildscript {
    repositories {
        mavenCentral()
        jcenter()
        maven { url "https://github.com/UKHomeOffice/pttg-gradle-repo/raw/master/releases" }
        maven { url "https://plugins.gradle.org/m2/" }
    }
    dependencies {
        classpath 'net.serenity-bdd:serenity-gradle-plugin:1.1.31'

        classpath 'pttg-gradle-common:pttgCommonGradle:1.2.RELEASE'
        classpath 'pttg-gradle-common:pttgApiDocsGradle:1.1.RELEASE'
        classpath 'pttg-gradle-common:pttgSpringBootGradle:1.1.RELEASE'

        // This shouldn't be needed. It should pull transitively from the plugin. Don't know why it isn't working.
        classpath "org.asciidoctor:asciidoctor-gradle-plugin:1.5.3"
        classpath "org.asciidoctor:asciidoctorj-pdf:1.5.0-alpha.11"
    }
}

apply plugin: 'scala'
apply plugin: 'net.serenity-bdd.aggregator'
apply plugin: 'pttgCommonGradle'
apply plugin: 'pttgSpringBootGradle'
apply plugin: 'pttgApiDocsGradle'

group 'uk.gov.digital.ho.proving.income'
version '1.0-SNAPSHOT'

mainClassName = "uk.gov.digital.ho.proving.financialstatus.api.ServiceRunner"

commonLibraries{
    springBootVersion = '1.3.5.RELEASE'
}

dependencies {

    compile libraries.groovy
    compile libraries.logging
    compile libraries.jackson
    compile libraries.jersey
    compile libraries.json
    compile libraries.springboot

    compile 'com.fasterxml.jackson.module:jackson-module-scala_2.11:2.7.4'
    compile 'org.apache.httpcomponents:httpclient:4.5.2'
    compile 'org.scala-lang:scala-library:2.11.8'

    testCompile libraries.cucumber
    testCompile libraries.groovy
    testCompile libraries.jackson
    testCompile libraries.jersey
    testCompile libraries.json
    testCompile libraries.restassured
    testCompile libraries.spock
    testCompile libraries.springTest
    testCompile libraries.testUtils

    testCompile 'cglib:cglib-nodep:3.2.1'
    testCompile 'org.objenesis:objenesis:2.2'
    testCompile 'org.scala-lang:scala-library:2.11.8'
    testCompile 'com.github.tomakehurst:wiremock:1.58'


    testCompile 'info.cukes:cucumber-java:1.2.4'
    testCompile 'info.cukes:cucumber-junit:1.2.4'
    testCompile 'info.cukes:gherkin:2.12.2'
    testCompile 'net.serenity-bdd:serenity-core:1.1.31'
    testCompile 'net.serenity-bdd:serenity-cucumber:1.1.6'
    testCompile 'net.serenity-bdd:serenity-junit:1.1.31'
    testCompile 'org.codehaus.groovy.modules.http-builder:http-builder:0.7.1'
    testCompile group: 'net.serenity-bdd', name: 'serenity-spring', version: '1.1.31'

}

springboot{
    port = 8080
}

compileGroovy.dependsOn "compileScala"
compileTestGroovy.dependsOn "compileTestScala"

tasks.withType(ScalaCompile) {
    scalaCompileOptions.with {
        force = true
    }
}

test {
    exclude 'acceptance/**'
}

task accept(type: Test) {
    include 'acceptance/**'
    finalizedBy aggregate
    outputs.upToDateWhen {false}
}

task acceptanceTest(type: Test) {
    description 'Runs the acceptance tests.'
    dependsOn 'accept'
    group 'verification'
    outputs.upToDateWhen {false}
}

